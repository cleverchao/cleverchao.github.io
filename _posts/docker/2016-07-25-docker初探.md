---
title: docker初探
excerpt: docker的一些概念和基本使用
tags: featured
permalink: /topics/docker/
categories:
  - topics
  - docker
author: zhengjiachao
#date/lastupdated are optional
#date: 2016-07-25 10:43:05
#lastupdated: 2016-07-25 10:43:05
---


# 一、docker WWW（What，Where，Why） #

## 1、what is docker ##

Docker是PaaS供应商dotCloud开源的一个基于LXC的高级容器引擎，源代码托管在 GitHub 上, 基于Go语言开发并遵从Apache 2.0协议开源。

Docker产生的目的就是为了解决以下问题:

1) 环境管理复杂: 从各种OS到各种中间件再到各种App，一款产品能够成功发布，作为开发者需要关心的东西太多，且难于管理，这个问题在软件行业中普遍存在并需要直接面对。Docker可以简化部署多种应用实例工作，比如Web应用、后台应用、数据库应用、大数据应用比如Hadoop集群、消息队列等等都可以打包成一个Image部署。

2) 云计算时代的到来: IaaS 解决了硬件管理的问题，然而软件配置和管理相关的问题依然存在。Docker的出现正好能帮助软件开发者开阔思路，尝试新的软件管理方法来解决这个问题。

3) 虚拟化手段的变化: 云时代采用标配硬件来降低成本，采用虚拟化手段来满足用户按需分配的资源需求以及保证可用性和隔离性。然而无论是KVM还是Xen，在 Docker 看来都在浪费资源，因为用户需要的是高效运行环境而非OS, GuestOS既浪费资源又难于管理, 更加轻量级的LXC更加灵活和快速。如图所示：
![](/images/docker/01.jpg)

4) LXC的便携性: LXC在 Linux 2.6 的 Kernel 里就已经存在了，但是其设计之初并非为云计算考虑的，缺少标准化的描述手段和容器的可便携性，决定其构建出的环境难于分发和标准化管理(相对于KVM之类image和snapshot的概念)。Docker就在这个问题上做出了实质性的创新方法。


## 2、where can I use docker ##

在传统模式中，开发团队在开发环境中完成软件开发，自己做了一遍单元测试， 测试通过，提交到代码版本管理库，打包给 QA 进行测试。运维把应用部署到测 试环境，QA 进行测试，没问题后通知部署人员发布到生产环境。

在上述过程中涉及到至少三个环境：开发、测试和生产。现实情况是，开发自测 没问题，但到了测试或者生产环境程序无法运行，让开发团队排查，经过长时间 排查最后发现是测试环境的一个第三方库过时了。这样的现象在软件开发中很普 遍，已经不适用如今的快速开发和部署。

在这种环境下，我们理所当然的希望能统一开发和测试以及生产的环境，让程序在每个阶段都运行在相同的环境中。要达到这个目的一般有如下几个选择：

a. 使用docker，把程序和运行环境都做成一个image，在不同的阶段都运行这个相同的image
b. 使用虚拟机技术，每一阶段都把程序和虚拟机镜像作为提交物提交给下一阶段
c. 直接把代码推到生产环境中（whatever， 这也是一个选择）

## 3、why docker ##

很明显的，把代码直接推到生产环境中这个选项除非在极特殊的情况下有人会选择之外，一般都是使用虚拟机或者docker技术。那么为什么使用docker而不是虚拟机呢？其实这个图已经看的很清楚了：
![](/images/docker/01.jpg)

可以看出来，虚拟机技术包含整个的操作系统，库和我们真正要运行的程序。它当然可以达到我们统一开发测试生产环境的目的，但是很明显，它太大了，对我们来说，我们想要的是我们的app能运行起来，而不是为了让它运行起来，装一整套可能99%都用不上的操作系统和lib。

说白了，我认为docker就是这么个东西：一个根据linux隔离技术而提供的可定制的最小的app的运行环境，既隔离又不是把整个操作系统都带到运行环境中。

只把app运行需要的环境打包起来，这就是我们选择docker的理由。


# 二、docker的基本概念 #

## 1.Docker 组件与元素 ##

Docker整体上由如下几个组件或元素组成：

* `Docker Client` ：docker是cs架构，docker client是客户端，它支持用户与Docker Daemon之间通信。
* `Docker Daemon` ：docker的服务端，运行于主机上，管理docker相关的运行，处理服务请求。
* `Docker Registry` ：docker使用registry来保存用户构建的镜像，分公有和私有两种。
* `Docker Containers`：负责应用程序的运行，包括操作系统、用户添加的文件以及元数据，它包含了应用程序和应用程序运行的整个环境。
* `Docker Images`：是一个只读模板，相当于容器的“源代码”，用来运行Docker容器。
* `DockerFile`：是文件指令集，用来说明如何自动创建Docker镜像。

![](/images/docker/02.png)



参考：
1. http://www.infoq.com/cn/articles/docker-core-technology-preview 
2. http://dockone.io/article/101